server:
  port: 9000

spring:
  application:
    name: api-gateway

  cloud:
    gateway:
      routes:
        # --- These routes use the Docker service names ---
        - id: user-service
          uri: http://user-service:8080
          predicates:
            - Path=/api/v1/users/**
        - id: post-service
          uri: http://post-service:8080
          predicates:
            - Path=/api/v1/posts/**
        - id: social-account-service
          uri: http://social-account-service:8080
          predicates:
            - Path=/api/v1/accounts/**, /api/v1/internal/**
        - id: analytics-service
          uri: http://analytics-service:8080
          predicates:
            - Path=/api/v1/analytics/**
        - id: media-service
          uri: http://media-service:8080
          predicates:
            - Path=/api/v1/media/**
        - id: ai-service
          uri: http://ai-service:8080
          predicates:
            - Path=/api/v1/ai/**

  # --- Spring Security Configuration (FIXED) ---
  security:
    oauth2:
      resourceserver:
        jwt:
          # These are the INTERNAL Docker network URLs.
          # This is cleaner and removes the need for compose variables.
          issuer-uri: http://keycloak:8080/realms/user-service
          jwk-set-uri: http://keycloak:8080/realms/user-service/protocol/openid-connect/certs

# --- Actuator (for health checks) ---
management:
  endpoints:
    web:
      exposure:
        include: health

# --- SpringDoc (Swagger) Configuration ---
springdoc:
  api-docs:
    groups:
      enabled: true
  gateway:
    discovery:
      locator:
        enabled: true
        discovery-id: api-gateway
  swagger-ui:
    oauth:
      # This points the "Authorize" button to the correct Keycloak client
      client-id: springdoc-swagger
      use-pkce-with-authorization-code-grant: true

logging:
  pattern:
    level: "%5p [${spring.application.name:},%X{X-Correlation-Id:-}]"