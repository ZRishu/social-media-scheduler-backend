sequenceDiagram
    participant Client
    participant Post Service
    participant Social Account Service
    participant Kafka
    participant Scheduler Service
    participant Social Media APIs

    box rgb(240, 240, 240) 1. Scheduling Flow
        Client->>+Post Service: POST /api/v1/posts/.../variants
        Note right of Post Service: User wants to schedule a post.

        Post Service->>+Social Account Service: GET /api/v1/accounts/{id} (Validate Account)
        Note left of Social Account Service: Is this a real account?
        Social Account Service-->>-Post Service: 200 OK (Yes, it's valid)

        Post Service->>+Kafka: Publishes `VariantReadyForSchedulingEvent`
        Note right of Kafka: The scheduling task is now in the queue.
        Kafka-->>-Scheduler Service: Consumes Event
        Note left of Scheduler Service: Creates a `ScheduledJob` in its database.
    end

    box rgb(230, 230, 250) 2. Publishing Flow
        Scheduler Service->>Scheduler Service: @Scheduled job wakes up and finds a due job.
        Note left of Scheduler Service: It's time to post!

        Scheduler Service->>+Social Account Service: POST /api/v1/accounts/{id}/quota/check
        Note left of Social Account Service: Can I post to this account right now?
        Social Account Service-->>-Scheduler Service: 200 OK (Yes, quota is available)

        Scheduler Service->>+Social Media APIs: Publishes the post
        Note right of Social Media APIs: The final step.
        Social Media APIs-->>-Scheduler Service: Success Response
    end